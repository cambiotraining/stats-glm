{
  "hash": "ed1e42f9cc4e02c2422c21e6d4f8b179",
  "result": {
    "markdown": "---\ntitle: \"Linear models\"\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n## Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfinches <- read_csv(\"data/finch_beaks.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 651 Columns: 5\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): species\ndbl (4): band, beak_length_mm, beak_depth_mm, year\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nfinches <- finches %>% \n  rename(blength = beak_length_mm,\n         bdepth = beak_depth_mm)\n```\n:::\n\n\n## Linear models\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = finches,\n       mapping = aes(x = blength,\n                     y = bdepth,\n                     colour = species)) +\n  geom_point() +\n  facet_wrap(facets = vars(year))\n```\n\n::: {.cell-output-display}\n![](glm-intro-lm_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfortis_1975 <- finches %>% \n  filter(species == \"fortis\",\n         year == 1975)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(fortis_1975, aes(blength, bdepth)) +\n  geom_point() +\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](glm-intro-lm_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### Least-squares regression\n\nFinding the line of best fit gives you the model. Each data point consists of the fitted value (the predicted beak depth at a given beak length), combined with the error. The error is the difference between the fitted value and the data point.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfortis_1975_example <- fortis_1975 %>% \n  mutate(min_depth = min(bdepth),\n         max_depth = max(bdepth),\n         min_length = min(blength),\n         max_length = max(blength)) \n\nlm_fortis_1975 <- lm(bdepth ~ blength,\n                     data = fortis_1975)\n\nfortis_1975_example <- lm_fortis_1975 %>% \n  augment() %>% \n  full_join(fortis_1975_example)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining, by = c(\"bdepth\", \"blength\")\n```\n:::\n\n```{.r .cell-code}\nfinch473 <- fortis_1975_example %>%\n  filter(band == 473)\n\nfortis_1975_example %>%\n  ggplot(aes(blength, bdepth)) +\n  geom_point(colour = \"#999999\") +\n  theme_bw() +\n  labs(title = \"Finch 473 (1975)\",\n       x = \"Beak length (mm)\",\n       y = \"Beak depth (mm)\") +\n  geom_point(data = . %>% filter(band == 473),\n             mapping = aes(blength, bdepth),\n             colour = \"#D55E00\",\n             size = 3) +\n  annotate(geom = \"text\", x = 9, y = 9.6, hjust = 0,\n           label = \"observed beak depth\") +\n  geom_segment(data = . %>% filter(band == 473),\n               aes(x = blength, xend = blength,\n                   y = min_depth, yend = bdepth),\n               linetype = \"dashed\",\n               colour = \"#D55E00\") +\n  annotate(geom = \"text\", x = 10.55, y = 8, hjust = 0,\n           label = \"observed beak length\") +\n  geom_segment(data = . %>% filter(band == 473),\n               aes(x = min_length, xend = blength,\n                   y = bdepth, yend = bdepth),\n               linetype = \"dashed\",\n               colour = \"#D55E00\") +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  geom_point(data = finch473, aes(x = blength,\n                                  y = .fitted),\n             colour = \"blue\", size = 3) +\n  geom_segment(data = finch473,\n               aes(x = blength, xend = (blength + 0.5),\n                   y = .fitted, yend = .fitted),\n               arrow = arrow(ends = \"first\", length = unit(2, \"mm\"))) +\n  annotate(geom = \"text\", x = 11.05, y = finch473$.fitted, hjust = 0,\n           label = \"fitted value\") +\n  geom_segment(data = finch473,\n               aes(x = blength, xend =  blength,\n                   y = bdepth, yend = .fitted),\n               arrow = arrow(ends = \"both\", length = unit(2, \"mm\"))) +\n  annotate(geom = \"text\", x = 10.45, y = 9.3, label = \"\\u03b5\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](glm-intro-lm_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nWe can then perform a linear regression. The question we're asking:\n\n> Is the line of best fit a better predictor of our data than a horizontal line across the average value?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfortis_1975_example %>%\n  ggplot(aes(blength, bdepth)) +\n  geom_point(colour = \"#999999\") +\n  theme_bw() +\n  labs(title = \"Finch beak observations (1975)\",\n       x = \"Beak length (mm)\",\n       y = \"Beak depth (mm)\") +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  geom_hline(yintercept = fortis_1975_example %>%\n               summarise(mean_bd = mean(bdepth)) %>%\n               pull(),\n             linetype = \"dashed\", colour = \"#D55E00\") +\n  annotate(geom = \"text\", x = 8.5, y = 9.3, hjust = 0,\n           label = \"average beak depth\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](glm-intro-lm_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfortis_1975_example %>% summarise(mean_bl = mean(blength)) %>% pull()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 10.58769\n```\n:::\n:::\n\nWhat we're actually testing is whether the slope of the line of best fit is any different from zero.\n\nTo find the answer, we perform an ANOVA.\n\n### ANOVA on the linear model\n\nWe define the linear model, then perform an ANOVA.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_fortis_1975 <- lm(bdepth ~ blength,\n                     data = fortis_1975)\n\nanova(lm_fortis_1975)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: bdepth\n           Df Sum Sq Mean Sq F value    Pr(>F)    \nblength     1 115.50 115.504  650.43 < 2.2e-16 ***\nResiduals 314  55.76   0.178                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nThe result suggests that `blength` is a statistically significant predictor of `bdepth`.\n\nWe can write the linear equation, if we know the model coefficients:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_fortis_1975\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = bdepth ~ blength, data = fortis_1975)\n\nCoefficients:\n(Intercept)      blength  \n    -0.3444       0.9007  \n```\n:::\n:::\n\n\nThe equation is in the form of:\n\n$Y = \\beta_0 + \\beta_1X$\n\nwhich in our case is\n\n$beak\\_depth = \\beta_0 + \\beta_1 \\times beak\\_length$\n\nand gives us\n\n$beak\\_depth = -0.34 + 0.90 \\times beak\\_length$\n\n### Assumptions\n\n1. Data should be linear\n2. Residuals are normally distributed\n3. Equality of variance\n4. Data are independent\n5. (no influential points)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_fortis_1975 %>% \n  resid_panel(plots = c(\"resid\", \"qq\", \"ls\", \"cookd\"),\n              smoother = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula 'y ~ x'\n`geom_smooth()` using formula 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](glm-intro-lm_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "glm-intro-lm_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}